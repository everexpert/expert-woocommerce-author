!function($){"use strict";var media_uploader=null,$systemStatusBtn;function open_media_uploader_image(event,imageSelectorButton){var $imageSelectorScope=imageSelectorButton.parent();(media_uploader=wp.media({frame:"post",state:"insert",multiple:!1})).on("insert",(function(){var json=media_uploader.state().get("selection").first().toJSON(),image_id=json.id,image_url,image_html='<img src="'+json.url+'" width="90" height="90">',current_selector="";switch(event.target.id){case"ewa_author_image_select":current_selector=".taxonomy-ewa-author #ewa_author_image";break;case"ewa_author_banner_select":current_selector=".taxonomy-ewa-author #ewa_author_banner"}$(current_selector).val(image_id),$(current_selector+"_result").remove(),$(".ewa_author_image_selected",$imageSelectorScope).length?$(".ewa_author_image_selected span",$imageSelectorScope).html(image_html):$imageSelectorScope.append('<div class="ewa_author_image_selected"><span>'+image_html+"</span></div>"),add_delete_link($imageSelectorScope)})),media_uploader.open()}function add_delete_link($imageSelectorScope){$(".ewa_author_image_selected span",$imageSelectorScope).append('<a href="#" class="ewa_author_image_selected_remove">X</a>'),$(".ewa_author_image_selected_remove",$imageSelectorScope).on("click",(function(event){event.preventDefault(),$(this).closest(".ewa_author_image_selected").remove(),$("#ewa_author_image",$imageSelectorScope).val(""),$("#ewa_author_banner",$imageSelectorScope).val("")}))}function ewaBindEventsToWigets(widget){var $currentWidget=$(".ewa-select-display-as");null!=widget&&($currentWidget=$(".ewa-select-display-as",widget)),$currentWidget.on("change",(function(){"author_logo"==$(this).val()?$(this).parent().siblings(".ewa-display-as-logo").addClass("show"):$(this).parent().siblings(".ewa-display-as-logo").removeClass("show")}))}$(".taxonomy-ewa-author #ewa_author_image_select, .taxonomy-ewa-author #ewa_author_banner_select").on("click",(function(event){open_media_uploader_image(event,$(this))})),$(".taxonomy-ewa-author #ewa_author_image_select, .taxonomy-ewa-author #ewa_author_banner_select").each((function(){add_delete_link($(this).parent())})),$("body").hasClass("edit-tags-php")&&$("body").hasClass("taxonomy-ewa-author")&&$(document).ajaxSuccess((function(event,xhr,settings){void 0!==settings&&settings.data&&~settings.data.indexOf("action=add-tag")&&~settings.data.indexOf("taxonomy=ewa-author")&&($("#ewa_author_image").val(""),$("#ewa_author_banner").val(""),$(".ewa_author_image_selected").remove())})),$(".taxonomy-ewa-author table .column-featured > span").not("ewa-blocked").on("click",(function(e){e.preventDefault();var $currentStar=$(this);$currentStar.addClass("ewa-blocked"),$currentStar.hasClass("dashicons-star-filled")?($currentStar.removeClass("dashicons-star-filled"),$currentStar.addClass("dashicons-star-empty")):($currentStar.removeClass("dashicons-star-empty"),$currentStar.addClass("dashicons-star-filled"));var data={action:"ewa_admin_set_featured_author",author:$currentStar.data("author-id")};$.post(ewa_ajax_object_admin.ajax_url,data,(function(response){if($currentStar.removeClass("ewa-blocked"),response.success){var $featuredCount=$(".taxonomy-ewa-author .ewa-featured-count > span");"up"==response.data.direction?$featuredCount.html(parseInt($featuredCount.text())+1):$featuredCount.html(parseInt($featuredCount.text())-1)}else alert(response.data.error_msg)}))})),$(".taxonomy-ewa-author #ewa-first-featured-authors").on("change",(function(e){e.preventDefault(),$("#screen-options-apply").replaceWith('<img src="'+ewa_ajax_object_admin.site_url+'/wp-admin/images/loading.gif">');var data={action:"ewa_admin_save_screen_settings",new_val:$(this).is(":checked")};$.post(ewa_ajax_object_admin.ajax_url,data,(function(response){location.reload()}))})),$(".ewa-edit-authors-bottom > span").on("click",(function(e){e.preventDefault(),$(".taxonomy-ewa-author #col-left").toggleClass("ewa-force-full-width"),$(".taxonomy-ewa-author #col-right").toggleClass("ewa-force-full-width")})),$(".ewa-admin-selectwoo").length&&$(".ewa-admin-selectwoo").selectWoo(),$("#wc_ewa_admin_tab_tools_migrate").on("change",(function(){if("-"!=$(this).val()&&confirm(ewa_ajax_object_admin.translations.migrate_notice)){$("html").append('<div class="ewa-modal"><div class="ewa-modal-inner"></div></div>'),$(".ewa-modal-inner").html("<p>"+ewa_ajax_object_admin.translations.migrating+"</p>");var data={action:"ewa_admin_migrate_authors",from:$(this).val()};$.post(ewa_ajax_object_admin.ajax_url,data,(function(response){setTimeout((function(){location.href=ewa_ajax_object_admin.authors_url}),1e3)}))}$(this).val("-")})),$("#wc_ewa_admin_tab_tools_dummy_data").on("change",(function(){if("-"!=$(this).val()&&confirm(ewa_ajax_object_admin.translations.dummy_data_notice)){$("html").append('<div class="ewa-modal"><div class="ewa-modal-inner"></div></div>'),$(".ewa-modal-inner").html("<p>"+ewa_ajax_object_admin.translations.dummy_data+"</p>");var data={action:"ewa_admin_dummy_data",from:$(this).val()};$.post(ewa_ajax_object_admin.ajax_url,data,(function(response){setTimeout((function(){location.href=ewa_ajax_object_admin.authors_url}),1e3)}))}$(this).val("-")})),$("#wc_ewa_admin_tab_tools_system_status").siblings("p").addClass("button wc_ewa_admin_tab_status_btn"),$(".wc_ewa_admin_tab_status_btn").on("click",(function(e){if(e.preventDefault(),!$("#wc_ewa_admin_status_result").length){var $systemStatusTextarea=$("#wc_ewa_admin_tab_tools_system_status");$('<pre id="wc_ewa_admin_status_result"></pre>').insertAfter($systemStatusTextarea),$("#wc_ewa_admin_status_result").click((function(e){e.preventDefault();var refNode=$(this)[0],range;if($.browser.msie)(range=document.body.createTextRange()).moveToElementText(refNode),range.select();else if($.browser.mozilla||$.browser.opera){var selection=window.getSelection(),range;(range=document.createRange()).selectNodeContents(refNode),selection.removeAllRanges(),selection.addRange(range)}else if($.browser.safari){var selection;(selection=window.getSelection()).setBaseAndExtent(refNode,0,refNode,1)}}))}$("#wc_ewa_admin_status_result").html('<img src="'+ewa_ajax_object_admin.site_url+'/wp-admin/images/spinner.gif" alt="Loading" height="20" width="20">'),$("#wc_ewa_admin_status_result").show();var data={action:"ewa_system_status"};$.post(ajaxurl,data,(function(response){$("#wc_ewa_admin_status_result").html(response),$("#wc_ewa_admin_status_result").trigger("click")}))})),$(document).on("click",".ewa-notice-dismissible .notice-dismiss",(function(e){e.preventDefault();var noticeName,data={action:"dismiss_ewa_notice",notice_name:$(this).closest(".ewa-notice-dismissible").data("notice")};$.post(ajaxurl,data,(function(response){}))})),ewaBindEventsToWigets(),$(document).bind("widget-added",(function(e,widget){ewaBindEventsToWigets(widget)})),$(document).on("widget-updated",(function(e,widget){ewaBindEventsToWigets(widget)})),$("button.ewa-authors-export").on("click",(function(e){e.preventDefault();var $clickedBtn=$(this);$clickedBtn.addClass("ewa-loading-overlay"),$clickedBtn.prop("disabled",!0);var data={action:"ewa_authors_export"};$.post(ewa_ajax_object_admin.ajax_url,data,(function(response){if(response.success){$clickedBtn.removeClass("ewa-loading-overlay"),$clickedBtn.prop("disabled",!1),$("#ewa-download-export-file").remove();var link=document.createElement("a");link.download="authors.json",link.id="ewa-download-export-file",link.href=response.data.export_file_url,$("body").append(link),link.click()}}))})),$("button.ewa-authors-import").on("click",(function(e){e.preventDefault(),$("input.ewa-authors-import-file").trigger("click")})),$("input.ewa-authors-import-file").on("change",(function(e){e.preventDefault();var $clickedBtn=$("button.ewa-authors-import");$clickedBtn.addClass("ewa-loading-overlay"),$clickedBtn.prop("disabled",!0);var file=$(this)[0].files[0],reqData=new FormData;reqData.append("action","ewa_authors_import"),reqData.append("file",file),$.ajax({url:ewa_ajax_object_admin.ajax_url,type:"post",cache:!1,dataType:"json",contentType:!1,processData:!1,data:reqData,success:function(resp){resp.success?($clickedBtn.removeClass("ewa-loading-overlay"),location.reload()):alert("Importer error")}})}))}(jQuery);